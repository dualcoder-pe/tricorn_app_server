#Strategy 6. Dynamic MA & Index based Rebalancing
for dynamic_ma_index_based_rebalance.py

### Approach
1. 1. 각 자산별로 5, 20, 60, 120 일간의 MA의 highest, lowest를 계산.
2. 각 일간의 lowest ~ highest의 구간을 5등분
3. 성장 자산의 비중
- 가장 낮은 1구간 혹은 그 아래인 경우 비중 20%, 
- 2구간은 18%
- 3구간은 16%
- 4구간은 14%
- 5구간 혹은 그 위인 경우 비중 12%


# Strategy 5. Dynamic Index-based Rebalancing
for dynamic_index_based_rebalance.py

### Approach
1. DGS10, CPIAUCSL, UNRATE, VIXCLS 값 가져오기
2. 리밸런싱일 기준으로 가장 가까운 위 지표 값 가져오기
3. 위 지표 기준으로 위험지표를 생성
4. 위험지표 생성 및 목표 비중 산출 룰
**위험 점수(`score`) 계산 공식:**  
score = 0.30 × expit(평균 price_ratio)  
   + 0.25 × expit(1 - 금리/10)  
   + 0.20 × expit(1 - 물가/10)  
   + 0.10 × expit(1 - 실업률/10)  
   + 0.15 × expit(1 - VIX/50)  
- expit(x)는 시그모이드 함수(1 / (1 + exp(-x)))  
- score는 0~1로 클리핑됨

**자산별 목표 비중(`weight`) 공식:**  
weight = min_weight + (max_weight - min_weight) × score  
- 자산별로 min_weight, max_weight는 사전에 정의됨  
- score가 0이면 최소비중, 1이면 최대비중  
- 모든 자산의 비중 합이 1이 되도록 정규화

5. 목표 비중에 맞춰 리밸런싱 (reb_date 시점 가격 기준)


# Strategy 4. Dynamic Ensemble MA-based Rebalancing
for dynamic_ma_based_rebalance.py

### Approach
1. 각 자산별로 5, 20, 60, 120 일간의 MA의 highest, lowest를 계산.
2. 각 일간의 lowest ~ highest의 구간을 5등분
3. 성장 자산의 비중
- 가장 낮은 1구간 혹은 그 아래인 경우 비중 20%, 
- 2구간은 18%
- 3구간은 16%
- 4구간은 14%
- 5구간 혹은 그 위인 경우 비중 12%
4. 각 자산의 Ensemble 비중은 window별 자산별 평가액을 동일가중 평균하여 기록
5. 이후 안전자산 비중 설정
- 플립스터(USDT)의 비중은 성장 자산의 비중을 제외한 나머지 자산의 2/3
- 발행어음의 비중은 성장 자산의 비중을 제외한 나머지 자산의 1/12
- 금의 비중은 성장 자산의 비중을 제외한 나머지 자산의 1/6
- 채권의 비중은 성장 자산의 비중을 제외한 나머지 자산의 1/12

# Strategy 3. Dynamic MA-based Rebalancing
for dynamic_ma_based_rebalance.py

### Approach
1. symbol별로 5, 20, 60, 120 일간 MA의 highest, lowest를 계산.
2. 각 일간의 lowest ~ highest의 구간을 5등분
3. 성장 자산의 비중
- 가장 낮은 1구간 혹은 그 아래인 경우 비중 20%, 
- 2구간은 18%
- 3구간은 16%
- 4구간은 14%
- 5구간 혹은 그 위인 경우 비중 12%
4. 안정 자산의 비중  
- 플립스터(USDT)의 비중은 성장 자산의 비중을 제외한 나머지 자산의 2/3
- 발행어음의 비중은 성장 자산의 비중을 제외한 나머지 자산의 1/12
- 금의 비중은 성장 자산의 비중을 제외한 나머지 자산의 1/6
- 채권의 비중은 성장 자산의 비중을 제외한 나머지 자산의 1/12


# Strategy 3. Dynamic Rebalancing
for dynamic_rebalance.py
### 하락폭에 따른 성장 자산 비중

| 하락폭 | 나스닥 | S&P  | 배당성장 | 코인 |
|------|------|------|------|------|
| -5%  | 13.5% | 14%  | 14%  | 4%   |
| -10% | 15%  | 16%  | 16%  | 4%   |
| -15% | 16.5% | 18%  | 18%  | 4%   |
| -20% | 18%  | 20%  | 20%  | 4%   |
| -25% | 19.5% |      |      | 4%   |
| -30% | 20%  |      |      | 4%   |
| -35% |      |      |      | 4%   |
| -40% |      |      |      | 5%   |

하락장에서의 성장 자산 비중
e.g. 나스닥이 전고점 대비 -20% 하락 시 -> 나스닥 비중은 18%, 
e.g. S&P가 전고점 대비 -20% 하락 시 -> S&P 20%
e.g. 배당성장(SCHD)이 전고점 대비 -20% 하락 시 -> 배당성장 20%
e.g. BTC가 전고점 대비 -40% 하락 시 -> 코인 5%

---

### 상승폭에 따른 성장 자산 비중

| 상승폭 | 나스닥 | S&P   | 배당성장 | 코인 |
|--------|--------|-------|-----------|------|
| 5%     | 20%    | 20%   | 20%       | 5%   |
| 10%    | 18%    | 17.5% | 17.5%     | 5%   |
| 15%    | 16%    | 15%   | 15%       | 5%   |
| 20%    | 14%    | 12.5% | 12.5%     | 5%   |
| 25%    | 12%    | 12%   | 12%       | 5%   |
| 30%    |        |       |           | 5%   |
| 35%    |        |       |           | 5%   |
| 40%    |        |       |           | 4%   |

상승장에서의 성장 자산 비중
e.g. 나스닥이 전고점 대비 20% 상승 시 -> 나스닥 비중은 14%, 
e.g. S&P가 전고점 대비 20% 상승 시 -> S&P 12.5%
e.g. 배당성장(SCHD)이 전고점 대비 20% 상승 시 -> 배당성장 12.5%
e.g. BTC가 전고점 대비 40% 상승 시 -> 코인 4%

---

### 전고점의 판단
pastPeak = 전고점
highest = 역대 최고가
- 하락장: 현재 가격이 highest보다 낮은 경우. pastPeak = highest
    - 하락장에서 현재 가격이 highest보다 높아지는 순간, pastPeak = 이 순간의 highest
- 상승장: 현재 가격이 highest보다 높은 경우. pastPeak는 기존의 pastPeak를 그대로 사용
    - 상승장에서 현재 가격이 highest보다 낮아지는 순간, pastPeak = 현재가격

---

### 자산 구성 및 리스크/리턴 프로파일

| 분류 | 최소투자 | 최대투자 | 종목       | 방어 | 공격 | MDD   |
|------|----------|----------|------------|------|------|-------|
| 성장 | 40%      | 65%      | 나스닥     | 12%  | 20%  | 30%   |
|      |          |          | S&P        | 12%  | 20%  | 20%   |
|      |          |          | 배당성장   | 12%  | 20%  | 20%   |
|      |          |          | 비트코인   | 4%   | 5%   | 40%   |
| 균형 | 40%      | 30%      | 플립스터   | 40%  | 30%  |       |
| 안정 | 20%      | 5%       | 발행어음   | 5%   | 1.25%|       |
|      |          |          | 금         | 10%  | 2.5% |       |
|      |          |          | 채권       | 5%   | 1.25%|       |
| 합계 | 100%     | 100%     |            |      |      |       |
위 표는 이해를 돕기 위한 사례임

---

### 투자 종목 설명
- 나스닥: QQQ
- S&P: SPY
- 배당성장: SCHD
- 비트코인: BTC
- 플립스터: USDT(일 복리 APR 7%)
- 발행어음: 1년 만기 발행어음 (연 복리 APR 3%)
- 채권: TLT


상승, 하락장에서 성장 자산 비중에 따른 잔여 자산 비중
- 방어는 강한 상승장이 온 상황이라 성장 자산을 줄여야 하는 상황
- 공격은 강한 하락장이 온 상황이라 성장 자산을 늘려야 하는 상황
e.g. 방어 상황이라 나스닥, S&P, 배당성장 비중이 12%, 비트코인 비중이 4%라면, 플립스터 비중은 40%, 발행어음 비중은 5%, 금 비중은 10%, 채권 비중은 5%로 설정됩니다. 이 비중은 방어와 공격에 따라 조정됩니다.

---

### 균형 자산과 안정 자산의 비중 결정
- 플립스터(USDT)의 비중은 잔여 공격 자산의 비중을 제외한 나머지 자산의 2/3
- 발행어음의 비중은 잔여 공격 자산의 비중을 제외한 나머지 자산의 1/12
- 금의 비중은 잔여 공격 자산의 비중을 제외한 나머지 자산의 1/6
- 채권의 비중은 잔여 공격 자산의 비중을 제외한 나머지 자산의 1/12


---

### 결론
- 10년간 총 불입액: 12,000.00원 
- 10년 후 총 자산가치: 23,735.52원
- 10년간 누적 수익률: 197.80%
- 10년간 CAGR: 7.06%
- 최대 낙폭(MDD): -10.47%

### Opinion
**전고점 판단 기준이 애매하다.**


# Strategy 2. Fixed Rebalancing
for static_rebalance.py

### 비중
```
DYNAMIC_ASSET_ALLOC = {
    Symbol.SPY: 0.20,
    Symbol.QQQ: 0.20,
    Symbol.SCHD: 0.20,
    Symbol.BTC: 0.05,
    Symbol.GOLD: 0.05,  # 금 ETF
    Symbol.TLT: 0.05,  # 20년물 국채 ETF
}

STABLE_ASSET_ALLOC = {
    Symbol.USDT: 0.20,  # 연 7% 일복리 채권
    Symbol.BOND_ANNUAL_3_5: 0.05,  # 연 3.5% 연복리 발행어음
}
```

### Approach

1. 매월 15일에 상기 비중으로 규칙적으로 자산 매수
2. 현재 가격을 반영하여 상기 비중을 맞추도록 리밸런싱

### 결론
- 10년간 총 불입액: 12,000.00만원
- 10년 후 총 자산가치: 83,583.18만원
- 10년간 누적 수익률: 696.53%
- 10년간 CAGR: 21.42%
- 최대 낙폭(MDD): -29.02%


# Strategy 1. Regular Buy & Hold
for rebalance.py

### 비중
```
DYNAMIC_ASSET_ALLOC = {
    Symbol.SPY: 0.20,
    Symbol.QQQ: 0.20,
    Symbol.SCHD: 0.20,
    Symbol.BTC: 0.05,
    Symbol.GOLD: 0.05,  # 금 ETF
    Symbol.TLT: 0.05,  # 20년물 국채 ETF
}

STABLE_ASSET_ALLOC = {
    Symbol.USDT: 0.20,  # 연 7% 일복리 채권
    Symbol.BOND_ANNUAL_3_5: 0.05,  # 연 3.5% 연복리 발행어음
}
```

### Approach

1. 매월 15일에 상기 비중으로 규칙적으로 자산 매수
2. 별도의 리밸런싱 없이 항상 동일 비중으로 매수

### 결론


# Common

### 목표
- CAGR 8% 이상
- MDD -10% 이상
- MDD가 -10%를 맞췄다면, CAGR 극대화를 목표로 전략 연구

### 매달 현재 자산의 가치를 구하는 방법
1. 주식, 코인 등 수량 기반의 자산
    - 보유 수량 * 현재가 (항상 수량을 기반으로 저장)
2. 채권, USDT 등 가치 기반의 자산
    - 보유 가치 * (1 + 이자율) * 일수
    - 일수는 지난달 리밸런싱 수행일 ~ 이번달 리밸런싱 수행일 (후행적으로 계산)
    - 이자율은 USDT는 일할 계산 (복리), 채권은 연복리 계산 후 월별로 나누어 적용 (월단위로 보면 단리, 년단위로 보면 연복리)